<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered dice prediction system with self-learning capabilities">
    <title>üé≤ DiceAI | Advanced Prediction System</title>

    <link rel="stylesheet" href="styles.css">

    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div style="max-width: 1400px; margin: 0 auto;">
            <h1 class="header-title">üé≤ DiceAI</h1>
            <p class="header-subtitle">Advanced Self-Learning Prediction System</p>

            <!-- Auth & Sync Status -->
            <div
                style="margin-top: var(--space-md); display: flex; gap: var(--space-md); align-items: center; justify-content: center; flex-wrap: wrap;">
                <button id="authButton" class="btn btn-sm"
                    style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);"
                    onclick="toggleAuthModal()">üîí Sign In</button>
                <div id="syncStatus" style="font-size: var(--font-size-xs); color: var(--color-text-tertiary);"></div>
            </div>

            <!-- Timeframe Selector -->
            <div
                style="margin-top: var(--space-lg); display: flex; gap: var(--space-md); align-items: center; justify-content: center; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: var(--space-sm);">
                    <label for="timeframeSelect"
                        style="color: var(--color-text-secondary); font-size: var(--font-size-sm); font-weight: 600;">
                        ‚è±Ô∏è Game Type:
                    </label>
                    <select id="timeframeSelect" class="timeframe-select" onchange="app.changeTimeframe(this.value)">
                        <option value="1min">1 Minute (1440 runs/day)</option>
                        <option value="3min" selected>3 Minutes (480 runs/day)</option>
                        <option value="5min">5 Minutes (288 runs/day)</option>
                        <option value="10min">10 Minutes (144 runs/day)</option>
                    </select>
                </div>
                <div id="currentGameInfo"
                    style="color: var(--color-text-tertiary); font-size: var(--font-size-sm); padding: var(--space-xs) var(--space-md); background: rgba(255,255,255,0.1); border-radius: var(--radius-sm); backdrop-filter: blur(10px);">
                    Current Run: <span id="currentRunNumber">--</span> | Next Period: <span
                        id="nextPeriodNumber">--</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">

        <!-- Prediction Section -->
        <div class="card" style="animation-delay: 0s;">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üîÆ</span>
                    AI Prediction
                </h3>
                <button class="btn btn-primary btn-sm" onclick="app.generatePrediction()">
                    Generate Prediction
                </button>
            </div>
            <div class="card-body">
                <div class="prediction-display">
                    <div class="prediction-number" id="predictionNumber">?</div>
                    <p class="prediction-label">Predicted Sum</p>

                    <div class="prediction-details">
                        <span id="predictionType">-</span>
                        <span id="predictionParity">-</span>
                    </div>

                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                    <p class="confidence-text">
                        <span id="confidenceText">-</span>
                    </p>

                    <!-- Competitive Mode Controls -->
                    <div
                        style="margin-top: var(--space-md); padding-top: var(--space-md); border-top: 1px solid var(--color-border);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
                            <label
                                style="font-size: var(--font-size-sm); color: var(--color-text-secondary); font-weight: 600;">
                                üèÜ Competitive Mode
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="competitiveModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="confidenceThresholdContainer" style="display: none;">
                            <label
                                style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-xs); display: block;">
                                Minimum Confidence: <span id="thresholdValue">55</span>%
                            </label>
                            <input type="range" id="confidenceThreshold" min="50" max="80" value="55"
                                style="width: 100%; accent-color: var(--color-primary);">
                        </div>

                        <!-- Theme Selector (NEW) -->
                        <div id="themeSelector"
                            style="margin-top: var(--space-md); padding-top: var(--space-md); border-top: 1px solid var(--color-border);">
                        </div>
                    </div>
                </div>

                <!-- Feedback Buttons -->
                <div class="feedback-buttons" id="feedbackButtons" style="display: none;">
                    <button class="btn btn-success" onclick="app.submitFeedback(true)">
                        ‚úì Correct
                    </button>
                    <button class="btn btn-error" onclick="app.submitFeedback(false)">
                        ‚úó Wrong
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Prediction Explanation (NEW) -->
        <div class="card" id="predictionExplanationCard" style="display: none; animation-delay: 0.05s;">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üí°</span>
                    Why This Prediction?
                </h3>
            </div>
            <div class="card-body">
                <div id="predictionExplanation"></div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="grid-2">
            <!-- Manual Entry -->
            <div class="card" style="animation-delay: 0.1s;">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">‚å®Ô∏è</span>
                        Enter Result
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Period Input -->
                    <div class="mb-md">
                        <label for="periodInput"
                            style="display: block; margin-bottom: var(--space-xs); color: var(--color-text-secondary); font-size: var(--font-size-sm); font-weight: 600;">
                            üìÖ Period Number
                        </label>
                        <input type="text" id="periodInput" placeholder="e.g., 2025122910102089"
                            style="width: 100%; padding: var(--space-sm); border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg-tertiary); color: var(--color-text); font-size: var(--font-size-base);">
                        <div id="periodValidation" style="margin-top: var(--space-xs); font-size: var(--font-size-xs);">
                        </div>
                    </div>

                    <!-- Dice Entry (Optional) -->
                    <div class="mb-md">
                        <label
                            style="display: block; margin-bottom: var(--space-xs); color: var(--color-text-secondary); font-size: var(--font-size-sm); font-weight: 600;">
                            üé≤ Individual Dice (Optional)
                        </label>
                        <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-sm);">
                            <input type="number" id="dice1" min="1" max="6" placeholder="D1"
                                style="flex: 1; padding: var(--space-sm); border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg-tertiary); color: var(--color-text); text-align: center;">
                            <input type="number" id="dice2" min="1" max="6" placeholder="D2"
                                style="flex: 1; padding: var(--space-sm); border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg-tertiary); color: var(--color-text); text-align: center;">
                            <input type="number" id="dice3" min="1" max="6" placeholder="D3"
                                style="flex: 1; padding: var(--space-sm); border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg-tertiary); color: var(--color-text); text-align: center;">
                        </div>
                        <div id="diceSum"
                            style="font-size: var(--font-size-sm); color: var(--color-text-muted); text-align: center;">
                        </div>
                    </div>

                    <p class="text-center mb-md" style="color: var(--color-text-secondary);">
                        Click a sum or enter dice above
                    </p>
                    <div class="number-pad" id="numberPad"></div>
                </div>
            </div>

            <!-- Image Upload -->
            <div class="card" style="animation-delay: 0.15s;">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üì∑</span>
                        Image Analysis
                    </h3>
                </div>
                <div class="card-body">
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">Drag & drop screenshots or click to upload</div>
                        <div class="upload-hint">Supports PNG, JPG, WebP ‚Ä¢ Bulk processing available</div>
                        <input type="file" id="fileInput" accept="image/png,image/jpeg,image/jpg,image/webp" multiple
                            style="display: none;">
                    </div>
                    <div id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="uploadProgressFill" style="width: 0%"></div>
                        </div>
                        <p class="text-center mt-sm" id="uploadStatus"
                            style="color: var(--color-text-secondary); font-size: var(--font-size-sm);"></p>
                    </div>
                    <div id="extractedNumbers" class="mt-md"></div>
                </div>
            </div>
        </div>

        <!-- Stats & Learning -->
        <div class="grid-2">
            <!-- Statistics -->
            <div class="card" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Statistics
                    </h3>
                </div>
                <div class="card-body">
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="statTotal">0</div>
                            <div class="stat-label">Total Rolls</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statAccuracy">--%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statBig">0</div>
                            <div class="stat-label">Big (11-18)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statSmall">0</div>
                            <div class="stat-label">Small (3-10)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning Status -->
            <div class="card" style="animation-delay: 0.25s;">
                <div class="card-header">
                    <h3 class="card-title">
                        <span class="card-icon">üß†</span>
                        Learning Status
                    </h3>
                </div>
                <div class="card-body">
                    <div id="learningInsights"></div>
                    <div class="mt-lg">
                        <h4
                            style="font-size: var(--font-size-base); margin-bottom: var(--space-md); color: var(--color-text-secondary);">
                            Algorithm Performance
                        </h4>
                        <div id="algorithmChart"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights (NEW) -->
        <div class="card" style="animation-delay: 0.28s;">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">ü§ñ</span>
                    AI Insights & Analysis
                </h3>
                <button class="btn btn-primary btn-sm" onclick="app.refreshAIInsights()">
                    üîÑ Refresh
                </button>
            </div>
            <div class="card-body">
                <div id="aiInsightsContainer">
                    <p style="color: var(--color-text-muted); text-align: center;">
                        Generate predictions to unlock AI insights...
                    </p>
                </div>
            </div>
        </div>

        <!-- Hot/Cold Heatmap -->
        <div class="card" style="animation-delay: 0.3s;">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üî•</span>
                    Hot & Cold Numbers
                </h3>
            </div>
            <div class="card-body">
                <p class="text-center mb-md"
                    style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                    Based on last 50 rolls ‚Ä¢ Red = Hot (frequent) ‚Ä¢ Blue = Cold (rare)
                </p>
                <div class="heatmap" id="heatmap"></div>
            </div>
        </div>

        <!-- History -->
        <div class="card" style="animation-delay: 0.35s;">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üìú</span>
                    History
                </h3>
                <div class="flex gap-md">
                    <button class="btn btn-outline btn-sm" onclick="app.exportData()">
                        üíæ Export
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="document.getElementById('importInput').click()">
                        üìÇ Import
                    </button>
                    <button class="btn btn-error btn-sm" onclick="app.clearAll()">
                        üóëÔ∏è Clear All
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="history-table-scroll">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Period</th>
                                <th>Sum</th>
                                <th>Dice</th>
                                <th>Type</th>
                                <th>Parity</th>
                                <th>Feedback</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="8"
                                    style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                                    No history yet. Add numbers to start predicting!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- Hidden import input -->
    <input type="file" id="importInput" accept=".json" style="display: none;">

    <!-- Firebase Auth Modal -->
    <div id="authModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center;">
        <div
            style="background: var(--color-bg-card); border-radius: var(--radius-lg); padding: var(--space-xl); max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                <h2 style="margin: 0; font-size: var(--font-size-xl);">üîê Sign In</h2>
                <button onclick="toggleAuthModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--color-text-secondary); padding: var(--space-xs);">√ó</button>
            </div>

            <div id="authContent"></div>

            <div
                style="margin-top: var(--space-lg); padding-top: var(--space-md); border-top: 1px solid var(--color-border); text-align: center; font-size: var(--font-size-sm); color: var(--color-text-muted);">
                Sync your data across all devices with cloud backup
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="data-manager.js"></script>
    <script src="ai-chat-assistant.js"></script>
    <script src="analytics-engine.js"></script>
    <script src="chart-visualizer.js"></script>
    <script src="prediction-tracker.js"></script>
    <script src="advanced-predictor.js"></script>
    <script src="notification-manager.js"></script>
    <script src="automation-engine.js"></script>
    <script src="voice-commands.js"></script>
    <script src="data-exporter.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-sync.js"></script>
    <script src="period-parser.js"></script>
    <script src="prediction-engine.js"></script>
    <script src="learning-engine.js"></script>
    <script src="image-analyzer.js"></script>
    <script src="ai-insights.js"></script>
    <script src="theme-manager.js"></script>
    <script src="advanced-ai.js"></script>
    <script src="app.js"></script>
    <script src="keyboard-shortcuts.js"></script>

    <script>
        // Initialize Firebase when page loads
        window.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            updateAuthUI();
        });

        // Auth UI functions
        function toggleAuthModal() {
            const modal = document.getElementById('authModal');
            const isVisible = modal.style.display === 'flex';
            modal.style.display = isVisible ? 'none' : 'flex';
            if (!isVisible) renderAuthContent();
        }

        function renderAuthContent() {
            const content = document.getElementById('authContent');
            const user = FirebaseAuth.getCurrentUser();

            if (user) {
                // Signed in
                content.innerHTML = `
                    <div style="text-align: center;">
                        <div style="margin-bottom: var(--space-md);">
                            <div style="font-size: 3rem; margin-bottom: var(--space-sm);">‚úÖ</div>
                            <div style="font-weight: 600; margin-bottom: var(--space-xs);">${user.email || 'Anonymous User'}</div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-success);">Signed in & syncing</div>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-sm);" onclick="manualSync()">üîÑ Sync Now</button>
                        <button class="btn btn-error" style="width: 100%;" onclick="signOut()">üö™ Sign Out</button>
                    </div>
                `;
            } else {
                // Signed out
                content.innerHTML = `
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-md);" onclick="signInWithGoogle()">Continue with Google</button>
                    <div style="text-align: center; margin: var(--space-md) 0; color: var(--color-text-muted); font-size: var(--font-size-sm);">or</div>
                    <button class="btn btn-outline" style="width: 100%;" onclick="signInAnonymous()">üë§ Continue as Guest</button>
                `;
            }
        }

        function updateAuthUI() {
            const button = document.getElementById('authButton');
            const user = FirebaseAuth.getCurrentUser();
            if (user) {
                button.textContent = `‚úì ${user.email ? user.email.split('@')[0] : 'Guest'}`;
                button.style.background = 'rgba(34, 197, 94, 0.2)';
            } else {
                button.textContent = 'üîí Sign In';
                button.style.background = 'rgba(255,255,255,0.1)';
            }
        }

        async function signInWithGoogle() {
            const result = await FirebaseAuth.signInWithGoogle();
            if (result.success) {
                updateAuthUI();
                toggleAuthModal();
            } else {
                alert('Sign in failed: ' + result.error);
            }
        }

        async function signInAnonymous() {
            const result = await FirebaseAuth.signInAnonymously();
            if (result.success) {
                updateAuthUI();
                toggleAuthModal();
            } else {
                alert('Sign in failed: ' + result.error);
            }
        }

        async function signOut() {
            const result = await FirebaseAuth.signOut();
            if (result.success) {
                updateAuthUI();
                renderAuthContent();
            }
        }

        async function manualSync() {
            if (window.app && window.app.firebaseSync) {
                await window.app.firebaseSync.manualSync();
            }
        }
    </script>
</body>

</html>